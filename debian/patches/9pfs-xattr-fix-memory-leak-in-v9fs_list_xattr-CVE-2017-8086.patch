From: Li Qiang <liq3ea@gmail.com>
Date: Fri, 7 Apr 2017 03:48:52 -0700
Subject: 9pfs: xattr: fix memory leak in v9fs_list_xattr (CVE-2017-8086)
Commit-Id: 4ffcdef4277a91af15a3c09f7d16af072c29f3f2
Bug-Debian: http://bugs.debian.org/861348

Free 'orig_value' in error path.

Signed-off-by: Li Qiang <liqiang6-s@360.cn>
Signed-off-by: Greg Kurz <groug@kaod.org>
---
 hw/9pfs/9p-xattr.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/hw/9pfs/9p-xattr.c b/hw/9pfs/9p-xattr.c
index eec160b3c2..d05c1a1c1d 100644
--- a/hw/9pfs/9p-xattr.c
+++ b/hw/9pfs/9p-xattr.c
@@ -108,6 +108,7 @@ ssize_t v9fs_list_xattr(FsContext *ctx, const char *path,
     g_free(name);
     close_preserve_errno(dirfd);
     if (xattr_len < 0) {
+        g_free(orig_value);
         return -1;
     }
 
-- 
2.11.0

